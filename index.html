<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üè≠ LƒÉng K√≠nh Ng∆∞·ªùi Ti√™u D√πng</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
  :root {
    --primary-color: #6d28d9; /* M√†u t√≠m ƒë·∫≠m */
    --secondary-color: #a78bfa; /* M√†u t√≠m nh·∫°t h∆°n */
    --background-light: #f3e8ff; /* N·ªÅn r·∫•t nh·∫°t */
    --background-gradient: linear-gradient(135deg, #fff8dc, #ffe4e6); /* N·ªÅn v√†ng h·ªìng */
    --card-background: #ffffff;
    --text-color: #333333;
    --success-color: #10b981; /* Xanh l√° */
    --error-color: #ef4444; /* ƒê·ªè */
    --border-radius-lg: 15px;
    --border-radius-md: 10px;
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  body {
    font-family: 'Roboto', sans-serif;
    background: var(--background-gradient);
    text-align: center;
    margin: 0;
    padding: 20px;
    color: var(--text-color);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    box-sizing: border-box;
  }

  h1 {
    color: var(--primary-color);
    font-size: 2.5em;
    margin-bottom: 30px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
  }

  h2 {
    color: var(--primary-color);
    margin-top: 20px;
  }

  #menu, #game-container {
    background: var(--card-background);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    padding: 30px;
    max-width: 550px;
    width: 90%;
    margin-top: 20px;
  }

  #menu h3 {
    color: var(--text-color);
    margin-bottom: 15px;
  }

  input[type="text"], select {
    padding: 12px 15px;
    border: 1px solid #d1d5db;
    border-radius: var(--border-radius-md);
    width: calc(100% - 30px); /* Adjust for padding */
    margin-bottom: 15px;
    font-size: 1em;
    box-sizing: border-box;
    transition: border-color 0.3s ease;
  }

  input[type="text"]:focus, select:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.2);
  }

  img#biscuitImage {
    max-width: 100%;
    height: auto;
    border-radius: var(--border-radius-md);
    margin-bottom: 25px;
    box-shadow: var(--shadow-md);
    background-color: #f0f0f0; /* Placeholder background */
    min-height: 200px; /* Minimum height for image container */
    object-fit: contain; /* Ensure image fits without cropping */
  }

  button {
    padding: 12px 25px;
    border: none;
    border-radius: var(--border-radius-md);
    margin: 8px;
    background-color: var(--primary-color);
    color: white;
    font-weight: bold;
    font-size: 1.1em;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  button:hover {
    background-color: var(--secondary-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }

  button:active {
    transform: translateY(0);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  }

  button.answer-btn-good {
    background-color: var(--success-color);
  }
  button.answer-btn-good:hover {
    background-color: #059669;
  }
  button.answer-btn-bad {
    background-color: var(--error-color);
  }
  button.answer-btn-bad:hover {
    background-color: #dc2626;
  }
  button.next-btn {
    background-color: var(--primary-color);
    margin-top: 20px;
  }
  button.next-btn:hover {
    background-color: var(--secondary-color);
  }

  #result {
    font-size: 1.3em;
    font-weight: bold;
    margin-top: 20px;
    min-height: 25px; /* Prevent layout shift */
  }

  #score, #timer {
    font-size: 1.2em;
    font-weight: bold;
    margin-top: 10px;
  }

  #score {
    color: var(--success-color);
  }

  #timer {
    color: var(--error-color);
    margin-bottom: 20px;
  }

  #errorSection {
    background-color: #fefce8; /* N·ªÅn v√†ng nh·∫°t */
    border: 1px solid #fde68a; /* Vi·ªÅn v√†ng */
    border-radius: var(--border-radius-md);
    padding: 15px;
    margin-top: 20px;
  }

  #errorSection p {
    color: #b45309; /* Ch·ªØ m√†u cam */
    font-weight: bold;
    margin-bottom: 10px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 25px;
    border-radius: var(--border-radius-md);
    overflow: hidden; /* Ensures border-radius applies to table */
    box-shadow: var(--shadow-md);
  }

  th, td {
    border: 1px solid #e5e7eb; /* M√†u vi·ªÅn b·∫£ng nh·∫°t */
    padding: 12px 10px;
    font-size: 0.95em;
    text-align: left;
  }

  th {
    background: var(--primary-color);
    color: white;
    font-weight: bold;
    text-transform: uppercase;
  }

  tr:nth-child(even) {
    background-color: #f9fafb; /* D√≤ng ch·∫µn m√†u h∆°i x√°m */
  }
  tr:hover {
    background-color: #f3f4f6; /* Hi·ªáu ·ª©ng hover cho d√≤ng */
  }

  @media (max-width: 600px) {
    h1 {
      font-size: 2em;
    }
    button {
      width: calc(100% - 16px);
      margin-left: 0;
      margin-right: 0;
    }
    input[type="text"], select {
      width: 100%;
    }
  }
</style>
</head>
<body>

<h1>üè≠ LƒÉng K√≠nh Ng∆∞·ªùi Ti√™u D√πng</h1>

<div id="menu">
  <h3>Nh·∫≠p t√™n c·ªßa b·∫°n:</h3>
  <input type="text" id="playerName" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n...">
  <h2>Ch·ªçn ch·∫ø ƒë·ªô ch∆°i:</h2>
  <button onclick="startGame('sanpham')"><i class="fas fa-cookie-bite"></i> S·∫£n ph·∫©m</button>
  <button onclick="startGame('baobi1')"><i class="fas fa-box"></i> Bao b√¨ c·∫•p 1</button>
  <button onclick="startGame('baobi2')"><i class="fas fa-boxes"></i> Bao b√¨ c·∫•p 2</button>
</div>

<div id="game-container" style="display:none;">
  <div id="timer">Th·ªùi gian: 20s</div>
  <img id="biscuitImage" src="" alt="·∫¢nh l·ªói QC">
  <div>
    <button class="answer-btn-good" onclick="checkAnswer(true)"><i class="fas fa-check-circle"></i> ƒê·∫°t</button>
    <button class="answer-btn-bad" onclick="checkAnswer(false)"><i class="fas fa-times-circle"></i> L·ªói</button>
  </div>

  <div id="errorSection" style="display:none;">
    <p>Ch·ªçn lo·∫°i l·ªói:</p>
    <select id="errorSelect"></select>
    <br>
    <button class="next-btn" onclick="submitError()"><i class="fas fa-check"></i> X√°c nh·∫≠n</button>
  </div>

  <div id="result"></div>
  <div id="score">ƒêi·ªÉm: 0</div>
  <br>
  <button class="next-btn" onclick="nextImage()"><i class="fas fa-arrow-right"></i> ·∫¢nh ti·∫øp theo</button>
</div>

<script>
// --- C·∫•u h√¨nh ---
const CONFIG = {
    // ƒê·∫£m b·∫£o ƒë∆∞·ªùng d·∫´n n√†y tr·ªè ƒë·∫øn th∆∞ m·ª•c ·∫£nh Raw Content tr√™n GitHub c·ªßa b·∫°n
    // V√≠ d·ª•: "https://raw.githubusercontent.com/lehienbqc53-cpu/Game-solite/main/images/"
    baseURL: "https://raw.githubusercontent.com/lehienbqc53-cpu/Game-solite/main/images/",
    scriptURL: "https://script.google.com/macros/s/AKfycbxKWLF-e4atMCwpdusjTk_EeQdD5ySRZOtVq3IyAANjtBxa66Gnp_jhl1C62qWKbd3Z/exec",
    timerDuration: 20 // seconds
};

// --- D·ªØ li·ªáu l·ªói (T√™n ·∫£nh v√† t√™n l·ªói) ---
const ERROR_DATA = {
    sanpham: {
        errors: [
            { src: "Banh_Mau_Khong_Dat.webp", correctError: "B√°nh m√†u kh√¥ng ƒë·∫°t" },
            { src: "Banh_Khong_Dat_Bong_Khi.webp", correctError: "B√°nh kh√¥ng ƒë·∫°t b√≥ng kh√≠" },
            { src: "Banh_Vet_Nut_Khong_Dat.webp", correctError: "B√°nh v·∫øt n·ª©t kh√¥ng ƒë·∫°t" },
            { src: "Banh_co_kem_khong_Dat.webp", correctError: "B√°nh c√≥ kem kh√¥ng ƒë·∫°t" },
            { src: "Banh_vo_Khong_Dat.webp", correctError: "B√°nh v·ª° kh√¥ng ƒë·∫°t" },
            { src: "Banh_Troc_Vo_Khong_Dat.webp", correctError: "B√°nh tr√≥c v·ªè kh√¥ng ƒë·∫°t" },
        ],
        goods: ["Banh_Mau_Dat.webp", "Banh_Co_Kem_Dat.webp", "Banh_Troc_Vo_Dat.webp", "Banh_Vo_Dat.webp", "Banh_Vet_Nut_Dat.webp","Banh_Dat_Bong_Khi.webp"]
    },
    baobi1: {
        errors: [
            { src: "Duong_Han_Qua_Nhiet.webp", correctError: "ƒê∆∞·ªùng h√†n qu√° nhi·ªát" },
            { src: "Duong_Han_Yeu.webp", correctError: "ƒê∆∞·ªùng h√†n y·∫øu" },
            { src: "Duong_Han_Can_Trang_Rach.webp", correctError: "ƒê∆∞·ªùng h√†n c·∫•n tr·∫Øng r√°ch" },
            { src: "Sai_Nhoe_Date.webp", correctError: "Sai, nh√≤e date" },
            { src: "Duong_Han_Bung_Dau_Dau_Lec.webp", correctError: "ƒê∆∞·ªùng h√†n bung ƒë·∫ßu, ƒë·∫ßu l·ªách" },
            { src: "Bang_Keo_noi_cuon.webp", correctError: "BƒÉng keo n·ªëi cu·ªôn" },
            { src: "Xep_Ly_xi.webp", correctError: "X·∫øp ly x√¨" }
        ],
        goods: ["Banh_dat.webp"]
    },
    baobi2: {
        errors: [
            { src: "Sap_xep_goi_banh_khong_dat.webp", correctError: "S·∫Øp x·∫øp g√≥i b√°nh kh√¥ng ƒë·∫°t" },
            { src: "Khay_Mop_Meo_Cong_Rach.webp", correctError: "Khay m√≥p m√©o cong r√°ch" },
            { src: "Mang_Co_Nhan_Rach.webp", correctError: "M√†ng co nhƒÉn r√°ch" },
            { src: "Sai_Nhoe_date.webp", correctError: "Sai, nh√≤e date" },
            { src: "Bang_Keo_nho_5mm_Khong_Dat.webp", correctError: "BƒÉng keo kh√¥ng ƒë·∫°t 5cm" },
            { src: "Thung_Mop_Meo.webp", correctError: "Th√πng m√≥p m√©o" },
            { src: "Thung_Thieu_Sai_Date.webp", correctError: "Th√πng thi·∫øu, sai date" },
            { src: "Sai_Thieu_date_hop.webp", correctError: "Sai, thi·∫øu date h·ªôp" },
            { src: "Hu_Hong_Duong_Mo.webp", correctError: "H∆∞ h·ªèng ƒë∆∞·ªùng m·ªü" },
            { src: "Lech_Nap_Hop.webp", correctError: "L·ªách n·∫Øp h·ªôp" },
            { src: "Nap_Hop_dan_Khong_dung.webp", correctError: "N·∫Øp h·ªôp d√°n kh√¥ng ƒë√∫ng" },
            { src: "Hu_hong_goc.webp", correctError: "H∆∞ h·ªèng g√≥c h·ªôp" },
            { src: "Hop_Bien_dang.webp", correctError: "H·ªôp bi·∫øn d·∫°ng" },
            { src: "Duong_Han_Keo_yeu_lem_keo.webp", correctError: "ƒê∆∞·ªùng h√†n keo y·∫øu, lem keo" }
        ],
        goods: ["Hop_Dat.webp"]
    }
};

// --- L·ªõp Qu·∫£n l√Ω Game (Gi·ªØ nguy√™n logic) ---
class QCGame {
    constructor() {
        this.images = [];
        this.mode = "";
        this.current = 0;
        this.score = 0;
        this.answered = false;
        this.timeLeft = CONFIG.timerDuration;
        this.timerInterval = null;
        this.playerName = "";

        this.dom = {
            menu: document.getElementById("menu"),
            gameContainer: document.getElementById("game-container"),
            playerNameInput: document.getElementById("playerName"),
            timerElement: document.getElementById("timer"),
            imgElement: document.getElementById("biscuitImage"),
            resultElement: document.getElementById("result"),
            scoreElement: document.getElementById("score"),
            errorSection: document.getElementById("errorSection"),
            errorSelect: document.getElementById("errorSelect")
        };

        window.startGame = this.startGame.bind(this);
        window.checkAnswer = this.checkAnswer.bind(this);
        window.submitError = this.submitError.bind(this);
        window.nextImage = this.nextImage.bind(this);
    }

    shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    loadGameData(mode) {
        const timestamp = `?v=${Date.now()}`;
        const data = ERROR_DATA[mode];
        
        let allImages = [];
        
        data.errors.forEach(err => {
            allImages.push({ 
                src: CONFIG.baseURL + err.src + timestamp, 
                isGood: false, 
                correctError: err.correctError 
            });
        });
        
        data.goods.forEach(goodSrc => {
            allImages.push({ 
                src: CONFIG.baseURL + goodSrc + timestamp, 
                isGood: true, 
                correctError: "ƒê·∫°t"
            });
        });

        this.shuffleArray(allImages);
        return allImages;
    }

    startGame(selectedMode) {
        this.playerName = this.dom.playerNameInput.value.trim();
        if (!this.playerName) {
            alert("H√£y nh·∫≠p t√™n!");
            return;
        }

        this.mode = selectedMode;
        this.images = this.loadGameData(this.mode);
        this.current = 0;
        this.score = 0;

        this.dom.menu.style.display = "none";
        this.dom.gameContainer.style.display = "block";

        this.loadErrorOptions();
        this.loadImage();
    }

    loadErrorOptions() {
        const errorList = ERROR_DATA[this.mode].errors.map(e => e.correctError);
        this.dom.errorSelect.innerHTML = "<option value=''>-- Ch·ªçn lo·∫°i l·ªói --</option>";
        errorList.forEach(opt => {
            const option = document.createElement("option");
            option.value = opt;
            option.textContent = opt;
            this.dom.errorSelect.appendChild(option);
        });
    }

    startTimer() {
        this.timeLeft = CONFIG.timerDuration;
        this.dom.timerElement.textContent = `Th·ªùi gian: ${this.timeLeft}s`;
        this.timerInterval = setInterval(() => {
            this.timeLeft--;
            this.dom.timerElement.textContent = `Th·ªùi gian: ${this.timeLeft}s`;
            if (this.timeLeft <= 0) {
                clearInterval(this.timerInterval);
                this.dom.resultElement.textContent = "‚è∞ H·∫øt th·ªùi gian!";
                this.answered = true;
                this.dom.errorSection.style.display = "none";
                setTimeout(this.nextImage.bind(this), 1500);
            }
        }, 1000);
    }

    checkAnswer(isGoodSelected) {
        if (this.answered) return;
        
        const currentImg = this.images[this.current];
        clearInterval(this.timerInterval);

        if (currentImg.isGood) {
            if (isGoodSelected) {
                this.dom.resultElement.textContent = "üéâ Ch√≠nh x√°c! ƒê√¢y l√† ·∫£nh ƒë·∫°t!";
                this.score++;
            } else {
                this.dom.resultElement.textContent = "‚ùå Sai r·ªìi! ƒê√¢y l√† ·∫£nh ƒë·∫°t.";
            }
            this.answered = true;
            this.dom.errorSection.style.display = "none";
            this.dom.scoreElement.textContent = "ƒêi·ªÉm: " + this.score;
        } else {
            if (!isGoodSelected) {
                this.dom.resultElement.textContent = "‚ùó ƒê√¢y l√† l·ªói, ch·ªçn lo·∫°i l·ªói!";
                this.dom.errorSection.style.display = "block";
            } else {
                this.dom.resultElement.textContent = "‚ùå Sai r·ªìi!";
                this.answered = true;
                this.dom.errorSection.style.display = "none";
            }
        }
    }

    submitError() {
        if (this.answered) return;
        
        const selected = this.dom.errorSelect.value;
        const currentImg = this.images[this.current];
        
        if (!selected) {
            this.dom.resultElement.textContent = "‚ö†Ô∏è Ch·ªçn lo·∫°i l·ªói!";
            return;
        }

        if (selected === currentImg.correctError) {
            this.dom.resultElement.textContent = "‚úÖ Ch√≠nh x√°c!";
            this.score++;
        } else {
            this.dom.resultElement.textContent = `‚ùå Sai lo·∫°i l·ªói. ƒê√°p √°n: ${currentImg.correctError}`;
        }
        
        this.dom.scoreElement.textContent = "ƒêi·ªÉm: " + this.score;
        this.answered = true;
        this.dom.errorSection.style.display = "none";
        clearInterval(this.timerInterval);
    }

    nextImage() {
        if (this.current < this.images.length - 1) {
            this.current++;
            this.loadImage();
        } else {
            this.showFinalScore();
        }
    }

    loadImage() {
        const currentImg = this.images[this.current];
        this.dom.imgElement.src = currentImg.src;
        this.dom.resultElement.textContent = "";
        this.dom.errorSection.style.display = "none";
        this.dom.errorSelect.value = "";
        this.answered = false;
        clearInterval(this.timerInterval);
        this.startTimer();
    }

    async postScore() {
        const response = await fetch(CONFIG.scriptURL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                action: "save",
                ten_nguoi_choi: this.playerName,
                muc_choi: this.mode,
                diem: this.score
            })
        });

        if (!response.ok) {
            throw new Error(`POST l·ªói ${response.status}`);
        }
        return response.text();
    }

    async getRanking() {
        const response = await fetch(CONFIG.scriptURL + "?action=getRanking");
        
        if (!response.ok) {
            throw new Error(`GET l·ªói ${response.status}`);
        }
        return response.json();
    }

    async showFinalScore() {
        clearInterval(this.timerInterval);
        this.dom.gameContainer.innerHTML = `<h2>üéâ Ho√†n th√†nh!</h2><p>ƒêi·ªÉm c·ªßa b·∫°n: <strong>${this.score}/${this.images.length}</strong></p><p>ƒêang l∆∞u k·∫øt qu·∫£...</p>`;

        try {
            await this.postScore();
            await new Promise(r => setTimeout(r, 500)); 
            const ranking = await this.getRanking();

            let tableHTML = `<h3>üèÜ B·∫£ng x·∫øp h·∫°ng TOP 10</h3><table><tr><th>H·∫°ng</th><th>T√™n</th><th>M·ª•c ch∆°i</th><th>ƒêi·ªÉm</th></tr>`;
            
            if (Array.isArray(ranking)) {
                ranking.slice(0, 10).forEach((r, i) => {
                    tableHTML += `<tr><td>${i + 1}</td><td>${r.name}</td><td>${r.mode}</td><td>${r.score}</td></tr>`;
                });
            } else {
                tableHTML += `<tr><td colspan='4'>Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`;
            }
            tableHTML += "</table><br><button onclick='location.reload()'><i class='fas fa-redo'></i> Ch∆°i l·∫°i</button>";

            this.dom.gameContainer.innerHTML = `<h2>üéâ Ho√†n th√†nh!</h2><p>ƒêi·ªÉm c·ªßa b·∫°n: <strong>${this.score}/${this.images.length}</strong></p>${tableHTML}`;

        } catch (err) {
            this.dom.gameContainer.innerHTML = `<h2>üéâ Ho√†n th√†nh!</h2><p>ƒêi·ªÉm c·ªßa b·∫°n: <strong>${this.score}/${this.images.length}</strong></p><p>‚ö†Ô∏è L·ªói: ${err.message}</p><button onclick='location.reload()'><i class='fas fa-redo'></i> Ch∆°i l·∫°i</button>`;
            console.error(err);
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    new QCGame();
});
</script>
</body>
</html>




