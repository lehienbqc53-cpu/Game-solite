<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¯ LÄƒng kÃ­nh ngÆ°á»i tiÃªu dÃ¹ng Solite</title>
<style>
body { font-family:"Segoe UI",Arial,sans-serif; background:linear-gradient(120deg,#fff8dc,#ffe4e6); text-align:center; margin:0; padding:20px;}
h1 { color:#6d28d9; }
#game-container { background:white; border-radius:20px; box-shadow:0 4px 10px rgba(0,0,0,0.15); display:inline-block; padding:20px; max-width:500px; width:100%; }
img { max-width:100%; border-radius:15px; margin-bottom:15px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
button { padding:10px 20px; border:none; border-radius:10px; margin:5px; background-color:#7c3aed; color:white; font-weight:bold; cursor:pointer; transition:0.3s;}
button:hover { background-color:#5b21b6;}
select, input { padding:10px; border-radius:8px; border:1px solid #ccc; width:80%; margin-top:5px; margin-bottom:10px;}
#result{font-size:18px;font-weight:bold;margin-top:15px;}
#score{font-size:18px;font-weight:bold;color:#16a34a;margin-top:10px;}
#timer{font-size:18px;font-weight:bold;color:#dc2626;margin-bottom:10px;}
table { width:100%; border-collapse:collapse; margin-top:15px; overflow-x: auto;}
th, td { border:1px solid #ccc; padding:8px; font-size:14px;}
th { background:#7c3aed; color:white;}
#ranking-container { margin-top:20px; text-align:left; display:none; }
</style>
</head>
<body>

<h1>ğŸ­ LÄƒng kÃ­nh ngÆ°á»i tiÃªu dÃ¹ng Solite</h1>

<div id="menu">
  <h3>Nháº­p tÃªn cá»§a báº¡n:</h3>
  <input type="text" id="playerName" placeholder="Nháº­p tÃªn...">
  <h2>Chá»n cháº¿ Ä‘á»™ chÆ¡i</h2>
  <button onclick="startGame('sanpham')">ğŸ¥¯ Sáº£n pháº©m</button>
  <button onclick="startGame('baobi1')">ğŸ“¦ Bao bÃ¬ cáº¥p 1</button>
  <button onclick="startGame('baobi2')">ğŸ“¦ Bao bÃ¬ cáº¥p 2</button>
</div>

<div id="game-container" style="display:none;">
  <div id="timer">Thá»i gian: 20s</div>
  <img id="biscuitImage" src="" alt="áº¢nh lá»—i QC">
  <div>
    <button onclick="checkAnswer(true)">âœ… Äáº¡t</button>
    <button onclick="checkAnswer(false)">âŒ Lá»—i</button>
  </div>
  <div id="errorSection" style="display:none;">
    <p>Chá»n loáº¡i lá»—i:</p>
    <select id="errorSelect"></select>
    <br>
    <button onclick="submitError()">XÃ¡c nháº­n</button>
  </div>
  <div id="result"></div>
  <div id="score">Äiá»ƒm: 0</div>
  <br>
  <button onclick="nextImage()">ğŸ‘‰ áº¢nh tiáº¿p theo</button>
</div>

<div id="ranking-container">
  <h2>ğŸ‰ HoÃ n thÃ nh!</h2>
  <p id="finalScore"></p>
  <label for="rankingModeSelect">Lá»c má»¥c chÆ¡i:</label>
  <select id="rankingModeSelect" onchange="updateRankingByMode()">
    <option value="">Táº¥t cáº£</option>
    <option value="Sáº£n pháº©m">Sáº£n pháº©m</option>
    <option value="Bao bÃ¬ cáº¥p 1">Bao bÃ¬ cáº¥p 1</option>
    <option value="Bao bÃ¬ cáº¥p 2">Bao bÃ¬ cáº¥p 2</option>
  </select>
  <table id="rankingTable"></table>
  <br>
  <button onclick="location.reload()">ğŸ”„ ChÆ¡i láº¡i</button>
</div>

<script>
// Google Sheet Web App URL (Apps Script má»›i)
const scriptURL = "https://script.google.com/macros/s/AKfycbyrWFK2_6oh7z48IA77LXGgDFwhNSjfSBUKpuKpY007TTIRzX1WgEpxWCtqsQF5NwCkrA/exec"; // Thay YOUR_WEB_APP_ID báº±ng cá»§a báº¡n

// ThÆ° má»¥c chá»©a áº£nh trÃªn Github
const baseURL = "https://raw.githubusercontent.com/lehienbqc53-cpu/Game-solite/main/images/";

// --- Danh sÃ¡ch áº£nh lá»—i vÃ  Ä‘áº¡t (giá»¯ nguyÃªn tá»« game Solite) ---
const productErrors = [
  { src:"Banh_Mau_Khong_Dat.webp", correctError:"BÃ¡nh mÃ u khÃ´ng Ä‘áº¡t" },
  { src:"Banh_Khong_Dat_Bong_Khi.webp", correctError:"BÃ¡nh khÃ´ng Ä‘áº¡t bÃ³ng khÃ­" },
  { src:"Banh_Vet_Nut_Khong_Dat.webp", correctError:"BÃ¡nh váº¿t ná»©t khÃ´ng Ä‘áº¡t" },
  { src:"Banh_co_kem_khong_Dat.webp", correctError:"BÃ¡nh cÃ³ kem khÃ´ng Ä‘áº¡t" },
  { src:"Banh_vo_Khong_Dat.webp", correctError:"BÃ¡nh vá»¡ khÃ´ng Ä‘áº¡t" },
  { src:"Banh_Troc_Vo_Khong_Dat.webp", correctError:"BÃ¡nh trÃ³c vá» khÃ´ng Ä‘áº¡t" }
];
const productGoods = ["Banh_Mau_Dat.webp","Banh_Co_Kem_Dat.webp","Banh_Troc_Vo_Dat.webp","Banh_Vo_Dat.webp","Banh_Vet_Nut_Dat.webp","Banh_Dat_Bong_Khi.webp"];

const pack1Errors = [
  { src:"Duong_Han_Qua_Nhiet.webp", correctError:"ÄÆ°á»ng hÃ n quÃ¡ nhiá»‡t" },
  { src:"Duong_Han_Yeu.webp", correctError:"ÄÆ°á»ng hÃ n yáº¿u" },
  { src:"Duong_han_can_trang_rach.webp", correctError:"ÄÆ°á»ng hÃ n cáº¥n tráº¯ng rÃ¡ch" },
  { src:"Sai_Nhoe_Date.webp", correctError:"Sai, nhÃ²e date" },
  { src:"Duong_han_bung_dau_duoi_lech.webp", correctError:"ÄÆ°á»ng hÃ n bung Ä‘áº§u, Ä‘áº§u lá»‡ch" },
  { src:"Bang_Keo_noi_cuon.webp", correctError:"BÄƒng keo ná»‘i cuá»™n" },
  { src:"Xep_Ly_xi.webp", correctError:"Xáº¿p ly xÃ¬" }
];
const pack1Goods = ["Banh_dat.webp"];

const pack2Errors = [
  { src:"Sap_xep_goi_banh_khong_dat.webp", correctError:"Sáº¯p xáº¿p gÃ³i bÃ¡nh khÃ´ng Ä‘áº¡t" },
  { src:"Khay_Mop_Meo_Cong_Rach.webp", correctError:"Khay mÃ³p mÃ©o cong rÃ¡ch" },
  { src:"Mang_Co_Nhan_Rach.webp", correctError:"MÃ ng co nhÄƒn rÃ¡ch" },
  { src:"Sai_Nhoe_date.webp", correctError:"Sai, nhÃ²e date" },
  { src:"Bang_Keo_nho_5mm_khong_dat.webp", correctError:"BÄƒng keo khÃ´ng Ä‘áº¡t 5cm" },
  { src:"Thung_Mop_Meo.webp", correctError:"ThÃ¹ng mÃ³p mÃ©o" },
  { src:"Thung_Thieu_Sai_date.webp", correctError:"ThÃ¹ng thiáº¿u, sai date" },
  { src:"Hu_Hong_Duong_Mo.webp", correctError:"HÆ° há»ng Ä‘Æ°á»ng má»Ÿ" },
  { src:"Lech_Nap_Hop.webp", correctError:"Lá»‡ch náº¯p há»™p" },
  { src:"Nap_hop_dan_khong_dung.webp", correctError:"Náº¯p há»™p dÃ¡n khÃ´ng Ä‘Ãºng" },
  { src:"Hu_hong_goc.webp", correctError:"HÆ° há»ng gÃ³c há»™p" },
  { src:"Hop_Bien_dang.webp", correctError:"Há»™p biáº¿n dáº¡ng" },
  { src:"Duong_han_keo_yeu_lem_keo.webp", correctError:"ÄÆ°á»ng hÃ n keo yáº¿u, lem keo" }
];
const pack2Goods = ["Hop_Dat.webp"];

// --- Biáº¿n game ---
let images=[], mode="", current=0, score=0, answered=false, timeLeft=20, timerInterval, playerName="";
const imgElement=document.getElementById("biscuitImage");
const resultElement=document.getElementById("result");
const errorSection=document.getElementById("errorSection");
const scoreElement=document.getElementById("score");
const timerElement=document.getElementById("timer");
const menu=document.getElementById("menu");
const gameContainer=document.getElementById("game-container");
const rankingContainer=document.getElementById("ranking-container");
const errorSelect=document.getElementById("errorSelect");
const finalScore=document.getElementById("finalScore");

// --- Mapping mode ---
const modeMap = { "sanpham":"Sáº£n pháº©m", "baobi1":"Bao bÃ¬ cáº¥p 1", "baobi2":"Bao bÃ¬ cáº¥p 2" };
const errorOptions = { sanpham: productErrors.map(e=>e.correctError), baobi1: pack1Errors.map(e=>e.correctError), baobi2: pack2Errors.map(e=>e.correctError) };

// --- Gá»­i Ä‘iá»ƒm lÃªn Google Sheet ---
async function saveScore(playerName, mode, score){
  try{
    await fetch(scriptURL, {
      method: "POST",
      contentType: "application/json",
      body: JSON.stringify({
        ten_nguoi_choi: playerName,
        muc_choi: modeMap[mode],
        diem: score
      })
    });
    console.log("Gá»­i Ä‘iá»ƒm OK");
  }catch(err){
    console.error(err);
  }
}

// --- Láº¥y báº£ng xáº¿p háº¡ng ---
async function getRanking(){
  try{
    const res = await fetch(scriptURL+"?action=getRanking");
    const data = await res.json();
    return data.map(r => ({ name: r.ten_nguoi_choi, mode: r.muc_choi, score: Number(r.diem) }));
  }catch(err){ console.error("GET lá»—i:", err); return [];}
}

// --- HÃ m há»— trá»£ ---
function shuffleArray(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]]; } }

function startGame(selectedMode){
  playerName=document.getElementById("playerName").value.trim();
  if(!playerName){ alert("HÃ£y nháº­p tÃªn!"); return; }
  mode=selectedMode;

  const baseErrors = mode==="sanpham"?productErrors:mode==="baobi1"?pack1Errors:pack2Errors;
  const baseGoods = mode==="sanpham"?productGoods:mode==="baobi1"?pack1Goods:pack2Goods;
  const timestamp="?v="+Date.now();
  images=baseErrors.map(img=>({...img, src:baseURL+img.src+timestamp, isGood:false}));
  baseGoods.forEach(g=>images.push({src:baseURL+g+timestamp,isGood:true}));
  
  shuffleArray(images);
  menu.style.display="none"; gameContainer.style.display="block";
  loadErrorOptions(); loadImage();
}

function loadErrorOptions(){
  errorSelect.innerHTML="<option value=''>-- Chá»n loáº¡i lá»—i --</option>";
  errorOptions[mode].forEach(opt=>{
    const option=document.createElement("option");
    option.value=opt; option.textContent=opt; errorSelect.appendChild(option);
  });
}

function startTimer(){
  timerElement.textContent=`Thá»i gian: ${timeLeft}s`;
  timerInterval=setInterval(()=>{
    timeLeft--; timerElement.textContent=`Thá»i gian: ${timeLeft}s`;
    if(timeLeft<=0){ clearInterval(timerInterval); resultElement.textContent="â° Háº¿t thá»i gian!"; answered=true; errorSection.style.display="none"; setTimeout(nextImage,1500); }
  },1000);
}

function checkAnswer(isGoodSelected){
  if(answered) return;
  const currentImg=images[current];
  if(currentImg.isGood){ resultElement.textContent="ğŸ‰ ChÃ­nh xÃ¡c! ÄÃ¢y lÃ  áº£nh Ä‘áº¡t!"; score++; scoreElement.textContent="Äiá»ƒm: "+score; answered=true; clearInterval(timerInterval); errorSection.style.display="none"; }
  else{ if(!isGoodSelected){ resultElement.textContent="â— ÄÃ¢y lÃ  lá»—i, chá»n loáº¡i lá»—i!"; errorSection.style.display="block"; } else{ resultElement.textContent="âŒ Sai rá»“i!"; errorSection.style.display="none"; } }
}

function submitError(){
  const selected=errorSelect.value;
  const currentImg=images[current];
  if(!selected){ resultElement.textContent="âš ï¸ Chá»n loáº¡i lá»—i!"; return; }
  if(selected===currentImg.correctError){ resultElement.textContent="âœ… ChÃ­nh xÃ¡c!"; score++; } 
  else{ resultElement.textContent="âŒ Sai loáº¡i lá»—i."; }
  scoreElement.textContent="Äiá»ƒm: "+score;
  answered=true; errorSection.style.display="none"; clearInterval(timerInterval);
}

function nextImage(){ if(current<images.length-1){ current++; loadImage(); } else{ showFinalScore(); } }

function loadImage(){ const currentImg=images[current]; imgElement.src=currentImg.src; resultElement.textContent=""; errorSection.style.display="none"; errorSelect.value=""; answered=false; clearInterval(timerInterval); timeLeft=20; startTimer(); }

async function showFinalScore(){
  clearInterval(timerInterval);
  gameContainer.style.display="none";
  rankingContainer.style.display="block";
  finalScore.textContent=`Äiá»ƒm cá»§a báº¡n: ${score}/${images.length}`;
  await saveScore(playerName, mode, score);
  await updateRankingByMode();
}

async function updateRankingByMode(){
  const selectedMode = document.getElementById("rankingModeSelect").value;
  const ranking = await getRanking();
  const filtered = selectedMode ? ranking.filter(r => r.mode===selectedMode) : ranking;
  const rankingTable = document.getElementById("rankingTable");
  let tableHTML = `<tr><th>Háº¡ng</th><th>TÃªn</th><th>Má»¥c chÆ¡i</th><th>Äiá»ƒm</th></tr>`;
  filtered.sort((a,b)=>b.score - a.score).slice(0,10).forEach((r,i)=>{
    tableHTML += `<tr><td>${i+1}</td><td>${r.name}</td><td>${r.mode}</td><td>${r.score}</td></tr>`;
  });
  rankingTable.innerHTML = tableHTML;
}

// Tá»± Ä‘á»™ng refresh báº£ng xáº¿p háº¡ng má»—i 10s
setInterval(()=>{ if(rankingContainer.style.display==="block") updateRankingByMode(); },10000);
</script>
</body>
</html>

