<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¯ LÄƒng kÃ­nh ngÆ°á»i tiÃªu dÃ¹ng</title>
<style>
Â  body { font-family:"Segoe UI",Arial,sans-serif; background:linear-gradient(120deg,#fff8dc,#ffe4e6); text-align:center; margin:0; padding:20px;}
Â  h1 { color:#6d28d9; }
Â  #game-container { background:white; border-radius:20px; box-shadow:0 4px 10px rgba(0,0,0,0.15); display:inline-block; padding:20px; max-width:500px; width:100%; }
Â  img { max-width:100%; border-radius:15px; margin-bottom:15px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
Â  button { padding:10px 20px; border:none; border-radius:10px; margin:5px; background-color:#7c3aed; color:white; font-weight:bold; cursor:pointer; transition:0.3s;}
Â  button:hover { background-color:#5b21b6;}
Â  select, input { padding:10px; border-radius:8px; border:1px solid #ccc; width:80%; margin-top:5px; margin-bottom:10px;}
Â  #result{font-size:18px;font-weight:bold;margin-top:15px;}
Â  #score{font-size:18px;font-weight:bold;color:#16a34a;margin-top:10px;}
Â  #timer{font-size:18px;font-weight:bold;color:#dc2626;margin-bottom:10px;}
Â  table { width:100%; border-collapse:collapse; margin-top:15px; overflow-x: auto;}
Â  th, td { border:1px solid #ccc; padding:8px; font-size:14px;}
Â  th { background:#7c3aed; color:white;}
</style>
</head>
<body>

<h1>ğŸ­ LÄƒng kÃ­nh ngÆ°á»i tiÃªu dÃ¹ng</h1>

<div id="menu">
Â  <h3>Nháº­p tÃªn cá»§a báº¡n:</h3>
Â  <input type="text" id="playerName" placeholder="Nháº­p tÃªn...">
Â  <h2>Chá»n cháº¿ Ä‘á»™ chÆ¡i</h2>
Â  <button onclick="startGame('sanpham')">ğŸ¥¯ Sáº£n pháº©m</button>
Â  <button onclick="startGame('baobi1')">ğŸ“¦ Bao bÃ¬ cáº¥p 1</button>
Â  <button onclick="startGame('baobi2')">ğŸ“¦ Bao bÃ¬ cáº¥p 2</button>
</div>

<div id="game-container" style="display:none;">
Â  <div id="timer">Thá»i gian: 20s</div>
Â  <img id="biscuitImage" src="" alt="áº¢nh lá»—i QC">
Â  <div>
Â  Â  <button onclick="checkAnswer(true)">âœ… Äáº¡t</button>
Â  Â  <button onclick="checkAnswer(false)">âŒ Lá»—i</button>
Â  </div>

Â  <div id="errorSection" style="display:none;">
Â  Â  <p>Chá»n loáº¡i lá»—i:</p>
Â  Â  <select id="errorSelect"></select>
Â  Â  <br>
Â  Â  <button onclick="submitError()">XÃ¡c nháº­n</button>
Â  </div>

Â  <div id="result"></div>
Â  <div id="score">Äiá»ƒm: 0</div>
Â  <br>
Â  <button onclick="nextImage()">ğŸ‘‰ áº¢nh tiáº¿p theo</button>
</div>

<script>
// --- Cáº¥u hÃ¬nh ---
const CONFIG = {
    baseURL: "https://github.com/lehienbqc53-cpu/Game-solite/images",
    scriptURL: "https://script.google.com/macros/s/AKfycbxKWLF-e4atMCwpdusjTk_EeQdD5ySRZOtVq3IyAANjtBxa66Gnp_jhl1C62qWKbd3Z/exec",
    timerDuration: 20 // seconds
};

// --- Dá»¯ liá»‡u lá»—i (TÃªn áº£nh Ä‘Ã£ khá»›p vá»›i tÃªn lá»—i má»›i) ---
const ERROR_DATA = {
    // Cháº¿ Ä‘á»™: ğŸ¥¯ Sáº£n pháº©m
    sanpham: {
        errors: [
            // Cá»™t src (TÃªn tá»‡p áº£nh) = Cá»™t correctError (TÃªn lá»—i trong báº£ng) + ".webp"
            { src: "Banh_Mau_Khong_Dat.webp", correctError: "BÃ¡nh mÃ u khÃ´ng Ä‘áº¡t" },
            { src: "Banh_Khong_Dat_Bong_Kh.webp", correctError: "BÃ¡nh khÃ´ng Ä‘áº¡t bÃ³ng khÃ­" },
            { src: "Banh_Vet_Nut_Khong_Dat.webp", correctError: "BÃ¡nh váº¿t ná»©t khÃ´ng Ä‘áº¡t" },
            { src: "Banh_co_kem_khong_Dat.webp", correctError: "BÃ¡nh cÃ³ kem khÃ´ng Ä‘áº¡t" },
            { src: "Banh_vo_Khong_Dat.webp", correctError: "BÃ¡nh vá» khÃ´ng Ä‘áº¡t" },
            { src: "Banh_Troc_Vo_Khong_Dat.webp", correctError: "BÃ¡nh trÃ³c vá» khÃ´ng Ä‘áº¡t" },
        ],
        // Giá»¯ nguyÃªn áº£nh Ä‘áº¡t (áº¢nh Ä‘áº¡t thÆ°á»ng khÃ´ng thay Ä‘á»•i tÃªn)
        goods: ["Banh_Dat_Mau", "Banh_co_Kem_Dat","Banh_Troc_Vo_Dat","Banh_Vo_Dat","Banh_Vet_Nut_Dat"] 
    },

    // Cháº¿ Ä‘á»™: ğŸ“¦ Bao bÃ¬ cáº¥p 1
    baobi1: {
        errors: [
            { src: "Duong_Han_Qua_Nhiet.webp", correctError: "ÄÆ°á»ng hÃ n quÃ¡ nhiá»‡t" },
            { src: "Duong_Han_Yeu.webp", correctError: "ÄÆ°á»ng hÃ n yáº¿u" },
            { src: "Duong_Han_Can_Trang_Rach.webp", correctError: "ÄÆ°á»ng hÃ n cáº¥n tráº¯ng rÃ¡ch" },
            { src: "Sai_Nhoe_Date.webp", correctError: "Sai, nhÃ²e date" },
            { src: "Duong_Han_Bung_Dau_Dau_Lec.webp", correctError: "ÄÆ°á»ng hÃ n bung Ä‘áº§u, Ä‘áº§u lá»‡ch" },
            { src: "Bang_Keo_noi_cuon.webp", correctError: "BÄƒng keo ná»‘i cuá»™n" },
            { src: "Xep_Ly_xi.webp", correctError: "Xáº¿p ly xÃ¬" }
        ],
        goods: ["Banh_dat"]
    },

    // Cháº¿ Ä‘á»™: ğŸ“¦ Bao bÃ¬ cáº¥p 2
    baobi2: {
        errors: [
            { src: "Sap_xep_goi_banh_khong_dat.webp", correctError: "Sáº¯p xáº¿p gÃ³i bÃ¡nh khÃ´ng Ä‘áº¡t" },
            { src: "Khay_Mop_Meo_Cong_Rach.webp", correctError: "Khay mÃ³p mÃ©o cong rÃ¡ch" },
            { src: "Mang_Co_Nhan_Rach.webp", correctError: "MÃ ng co nhÄƒn rÃ¡ch" },
            { src: "Sai_Nhoe_date.webp", correctError: "Sai, nhÃ²e date" },
            { src: "Bang_Keo_nho_5mm_Khong_Dat.webp", correctError: "BÄƒng keo khÃ´ng Ä‘áº¡t 5cm" },
            { src: "Thung_Mop_Meo.webp", correctError: "ThÃ¹ng mÃ³p mÃ©o" },
            { src: "Thung_Thieu_Sai_Date.webp", correctError: "ThÃ¹ng thiáº¿u, sai date" },
            { src: "Sai_Thieu_date_hop.webp", correctError: "Sai, thiáº¿u date há»™p" },
            { src: "Hu_Hong_Duong_Mo.webp", correctError: "HÆ° há»ng Ä‘Æ°á»ng má»Ÿ" },
            { src: "Lech_Nap_Hop.webp", correctError: "Lá»‡ch náº¯p há»™p" },
            { src: "Nap_Hop_dan_Khong_dung.webp", correctError: "Náº¯p há»™p dÃ¡n khÃ´ng Ä‘Ãºng" },
            { src: "Hu_hong_goc.webp", correctError: "HÆ° há»ng gÃ³c há»™p" },
            { src: "Hop_Bien_dang.webp", correctError: "Há»™p biáº¿n dáº¡ng" },
            { src: "Duong_Han_Keo_yeu_lem_keo.webp", correctError: "ÄÆ°á»ng hÃ n keo yáº¿u, lem keo" } 
        ],
        goods: ["Hop_Dat.webp"]
    }
};

// --- Lá»›p Quáº£n lÃ½ Game ---
class QCGame {
    constructor() {
        this.images = [];
        this.mode = "";
        this.current = 0;
        this.score = 0;
        this.answered = false;
        this.timeLeft = CONFIG.timerDuration;
        this.timerInterval = null;
        this.playerName = "";

        // DOM Elements
        this.dom = {
            menu: document.getElementById("menu"),
            gameContainer: document.getElementById("game-container"),
            playerNameInput: document.getElementById("playerName"),
            timerElement: document.getElementById("timer"),
            imgElement: document.getElementById("biscuitImage"),
            resultElement: document.getElementById("result"),
            scoreElement: document.getElementById("score"),
            errorSection: document.getElementById("errorSection"),
            errorSelect: document.getElementById("errorSelect")
        };

        // GÃ¡n cÃ¡c hÃ m vÃ o scope toÃ n cá»¥c Ä‘á»ƒ gá»i tá»« HTML
        window.startGame = this.startGame.bind(this);
        window.checkAnswer = this.checkAnswer.bind(this);
        window.submitError = this.submitError.bind(this);
        window.nextImage = this.nextImage.bind(this);
    }

    // HÃ m trá»™n máº£ng
    shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // HÃ m táº£i dá»¯ liá»‡u áº£nh cho game
    loadGameData(mode) {
        const timestamp = `?v=${Date.now()}`;
        const data = ERROR_DATA[mode];
        
        let allImages = [];
        
        // 1. Lá»—i
        data.errors.forEach(err => {
            allImages.push({ 
                src: CONFIG.baseURL + err.src + timestamp, 
                isGood: false, 
                correctError: err.correctError 
            });
        });
        
        // 2. Äáº¡t
        data.goods.forEach(goodSrc => {
            allImages.push({ 
                src: CONFIG.baseURL + goodSrc + timestamp, 
                isGood: true, 
                correctError: "Äáº¡t" // GiÃ¡ trá»‹ máº·c Ä‘á»‹nh cho áº£nh Ä‘áº¡t
            });
        });

        this.shuffleArray(allImages);
        return allImages;
    }

    // Báº¯t Ä‘áº§u game
    startGame(selectedMode) {
        this.playerName = this.dom.playerNameInput.value.trim();
        if (!this.playerName) {
            alert("HÃ£y nháº­p tÃªn!");
            return;
        }

        this.mode = selectedMode;
        this.images = this.loadGameData(this.mode);
        this.current = 0;
        this.score = 0;

        // áº¨n menu, hiá»‡n game
        this.dom.menu.style.display = "none";
        this.dom.gameContainer.style.display = "block";

        this.loadErrorOptions();
        this.loadImage();
    }

    // Load options lá»—i vÃ o select
    loadErrorOptions() {
        const errorList = ERROR_DATA[this.mode].errors.map(e => e.correctError);
        this.dom.errorSelect.innerHTML = "<option value=''>-- Chá»n loáº¡i lá»—i --</option>";
        errorList.forEach(opt => {
            const option = document.createElement("option");
            option.value = opt;
            option.textContent = opt;
            this.dom.errorSelect.appendChild(option);
        });
    }

    // Báº¯t Ä‘áº§u Timer
    startTimer() {
        this.timeLeft = CONFIG.timerDuration;
        this.dom.timerElement.textContent = `Thá»i gian: ${this.timeLeft}s`;
        this.timerInterval = setInterval(() => {
            this.timeLeft--;
            this.dom.timerElement.textContent = `Thá»i gian: ${this.timeLeft}s`;
            if (this.timeLeft <= 0) {
                clearInterval(this.timerInterval);
                this.dom.resultElement.textContent = "â° Háº¿t thá»i gian!";
                this.answered = true;
                this.dom.errorSection.style.display = "none";
                setTimeout(this.nextImage.bind(this), 1500);
            }
        }, 1000);
    }

    // Kiá»ƒm tra Ä‘Ã¡p Ã¡n
    checkAnswer(isGoodSelected) {
        if (this.answered) return;
        
        const currentImg = this.images[this.current];
        clearInterval(this.timerInterval);

        if (currentImg.isGood) {
            // áº¢nh Äáº¡t
            if (isGoodSelected) {
                this.dom.resultElement.textContent = "ğŸ‰ ChÃ­nh xÃ¡c! ÄÃ¢y lÃ  áº£nh Ä‘áº¡t!";
                this.score++;
            } else {
                this.dom.resultElement.textContent = "âŒ Sai rá»“i! ÄÃ¢y lÃ  áº£nh Ä‘áº¡t.";
            }
            this.answered = true;
            this.dom.errorSection.style.display = "none";
            this.dom.scoreElement.textContent = "Äiá»ƒm: " + this.score;
        } else {
            // áº¢nh Lá»—i
            if (!isGoodSelected) {
                this.dom.resultElement.textContent = "â— ÄÃ¢y lÃ  lá»—i, chá»n loáº¡i lá»—i!";
                this.dom.errorSection.style.display = "block";
            } else {
                this.dom.resultElement.textContent = "âŒ Sai rá»“i!";
                this.answered = true;
                this.dom.errorSection.style.display = "none";
            }
        }
    }

    // XÃ¡c nháº­n loáº¡i lá»—i
    submitError() {
        if (this.answered) return;
        
        const selected = this.dom.errorSelect.value;
        const currentImg = this.images[this.current];
        
        if (!selected) {
            this.dom.resultElement.textContent = "âš ï¸ Chá»n loáº¡i lá»—i!";
            return;
        }

        if (selected === currentImg.correctError) {
            this.dom.resultElement.textContent = "âœ… ChÃ­nh xÃ¡c!";
            this.score++;
        } else {
            this.dom.resultElement.textContent = `âŒ Sai loáº¡i lá»—i. ÄÃ¡p Ã¡n: ${currentImg.correctError}`;
        }
        
        this.dom.scoreElement.textContent = "Äiá»ƒm: " + this.score;
        this.answered = true;
        this.dom.errorSection.style.display = "none";
        clearInterval(this.timerInterval);
    }

    // Chuyá»ƒn sang áº£nh tiáº¿p theo
    nextImage() {
        if (this.current < this.images.length - 1) {
            this.current++;
            this.loadImage();
        } else {
            this.showFinalScore();
        }
    }

    // Táº£i áº£nh má»›i
    loadImage() {
        const currentImg = this.images[this.current];
        this.dom.imgElement.src = currentImg.src;
        this.dom.resultElement.textContent = "";
        this.dom.errorSection.style.display = "none";
        this.dom.errorSelect.value = "";
        this.answered = false;
        clearInterval(this.timerInterval);
        this.startTimer();
    }

    // Gá»­i Ä‘iá»ƒm lÃªn Google Apps Script
    async postScore() {
        const response = await fetch(CONFIG.scriptURL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                action: "save",
                ten_nguoi_choi: this.playerName,
                muc_choi: this.mode,
                diem: this.score
            })
        });

        if (!response.ok) {
            throw new Error(`POST lá»—i ${response.status}`);
        }
        return response.text();
    }

    // Láº¥y báº£ng xáº¿p háº¡ng tá»« Google Apps Script
    async getRanking() {
        const response = await fetch(CONFIG.scriptURL + "?action=getRanking");
        
        if (!response.ok) {
            throw new Error(`GET lá»—i ${response.status}`);
        }
        return response.json();
    }

    // Hiá»ƒn thá»‹ káº¿t quáº£ cuá»‘i cÃ¹ng vÃ  xáº¿p háº¡ng
    async showFinalScore() {
        clearInterval(this.timerInterval);
        this.dom.gameContainer.innerHTML = `<h2>ğŸ‰ HoÃ n thÃ nh!</h2><p>Äiá»ƒm cá»§a báº¡n: <strong>${this.score}/${this.images.length}</strong></p><p>Äang lÆ°u káº¿t quáº£...</p>`;

        try {
            await this.postScore();
            await new Promise(r => setTimeout(r, 500)); 
            const ranking = await this.getRanking();

            let tableHTML = `<h3>ğŸ† Báº£ng xáº¿p háº¡ng TOP 10</h3><table><tr><th>Háº¡ng</th><th>TÃªn</th><th>Má»¥c chÆ¡i</th><th>Äiá»ƒm</th></tr>`;
            
            if (Array.isArray(ranking)) {
                ranking.slice(0, 10).forEach((r, i) => {
                    tableHTML += `<tr><td>${i + 1}</td><td>${r.name}</td><td>${r.mode}</td><td>${r.score}</td></tr>`;
                });
            } else {
                tableHTML += `<tr><td colspan='4'>KhÃ´ng cÃ³ dá»¯ liá»‡u</td></tr>`;
            }
            tableHTML += "</table><br><button onclick='location.reload()'>ğŸ”„ ChÆ¡i láº¡i</button>";

            this.dom.gameContainer.innerHTML = `<h2>ğŸ‰ HoÃ n thÃ nh!</h2><p>Äiá»ƒm cá»§a báº¡n: <strong>${this.score}/${this.images.length}</strong></p>${tableHTML}`;

        } catch (err) {
            this.dom.gameContainer.innerHTML = `<h2>ğŸ‰ HoÃ n thÃ nh!</h2><p>Äiá»ƒm cá»§a báº¡n: <strong>${this.score}/${this.images.length}</strong></p><p>âš ï¸ Lá»—i: ${err.message}</p><button onclick='location.reload()'>ğŸ”„ ChÆ¡i láº¡i</button>`;
            console.error(err);
        }
    }
}

// Khá»Ÿi táº¡o Game khi trang web táº£i xong
document.addEventListener('DOMContentLoaded', () => {
    new QCGame();
});
</script>
</body>
</html>


